---
title: "Econ_hw_3"
author: "Sarah Rohlfing"
date: "5/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(here)

```


```{r}
hw3_data <- read.csv(here("data", "HW3_data.csv")) %>% 
  clean_names()
```

```{r}
elec_longer <- pivot_longer(data =hw3_data,
                            cols = q_low_kwh:q_high_kwh,
                            names_to = "income_group",
                            values_to = "quantity_kwh")
```

```{r}

ggplot(data = elec_longer, aes(y = price_cents, x = quantity_kwh)) +
  geom_point() +
  geom_smooth(method =lm, se = FALSE) +
  facet_wrap( ~income_group)+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for low and high income households")

```
```{r}
#hw3_data %>% 
#hw3_data$q_agg_sum = q_low_kwh + q_high_kwh
```


```{r}
low.income.lm <-lm(price_cents ~ q_low_kwh, data = hw3_data)
slope.low <- low.income.lm$coefficient[2]
intercept.low <- low.income.lm$coefficient[1]
vector_range <- seq(0, 160000, length.out = 19)
hw3_data$low_demand = slope.low*(vector_range) + intercept.low

ggplot(data = hw3_data, aes(y = price_cents, x = low_demand)) +
  geom_line() +
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for low income")

```
```{r}
high.income.lm <-lm(price_cents ~ q_high_kwh, data = hw3_data)
slope.high <- high.income.lm$coefficient[2]
intercept.high <- high.income.lm$coefficient[1]
hw3_data$high_demand = slope.high*(vector_range) + intercept.high

ggplot(data = hw3_data, aes(y = price_cents, x = high_demand)) +
  geom_line()+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for high income")
```

```{r}
demand <- function(p, model){
  q <- (p - model$coefficients[1])/model$coefficients[2]
  q <- ifelse(q<0, 0, q)
  return(q)
}


```

```{r}
demand_ex <- demand(p=10, model = low.income.lm) #(example: to find what demand function will output at price = 2)
```


```{r}
demand_agg <- function(p){
  q <- demand(p, low.income.lm) + demand(p, high.income.lm)
  return(q)
}
price = seq(0, 30, length.out = 100)
Qagg <- map(price, demand_agg) %>% unlist()
df<- tibble(Qagg = Qagg, price = price)

ggplot(data = df, aes(y = price, x = Qagg)) +
  geom_line()+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Aggregate Demand")
```


```{r}
q_star_agg <- demand_agg(p=10) # q_star_agg = 536,719 kwH
p_star_before_tax <- 10 #10 cents is p star
```

```{r}
# find slope for supply curve
mpc_slope = p_star_before_tax/q_star_agg # slope of supply curve = 1.86e-5

hw3_data$q_kwh_sum <- hw3_data$q_low_kwh + hw3_data$q_high_kwh


df$supply_lm <- mpc_slope * df$price


#df$mpc_prices = mpc_slope*(Qagg) 

ggplot(data = df, aes(y = price, x = supply_lm)) +
  geom_point()

```

```{r}
# $51/1 metric ton * 0.000453592 metric tons/1 lb = $.0231/lb *.85 lb/kwh = $0.01966/kwh
# $ 0.10 + $0.01966 = $0.13/kwh (marginal external cost/kwh)

mec_per_kwh <- 0.13 # <- marginal external cost
```

```{r}
CS <- function(p, model){
  q <- demand(p, model)
  cs <- 0.5*(model$coefficients[1] - p)*q
  return(cs)}

# CS_ex <- CS(p = 10, model = low.income.lm) to test low income consumer surplus

CS_agg <- function(p){
  cs <- CS(p,low.income.lm) + CS(p,high.income.lm)
  return(cs)}

agg_consumer_surplus <- CS_agg(p=10) # = $52,987.22
```

```{r}
PS <- function(p, model){
  q <- demand(p, model)
  cs <- 0.5*(model$coefficients[1] - p)*q
  return(cs)}

PS_agg <- function(p){
  cs <- CS(p,low.income.lm) + CS(p,high.income.lm)
  return(cs)}
```



