---
title: "Econ_hw_3"
author: "Sarah Rohlfing"
date: "5/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(here)

```


```{r}
hw3_data <- read.csv(here("data", "HW3_data.csv")) %>% 
  clean_names()
```

```{r}
elec_longer <- pivot_longer(data =hw3_data,
                            cols = q_low_kwh:q_high_kwh,
                            names_to = "income_group",
                            values_to = "quantity_kwh")
```

```{r}

ggplot(data = elec_longer, aes(y = price_cents, x = quantity_kwh)) +
  geom_point() +
  geom_smooth(method =lm, se = FALSE) +
  facet_wrap( ~income_group)+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for low and high income households")

```


```{r}
low.income.lm <-lm(price_cents ~ q_low_kwh, data = hw3_data)
slope.low <- low.income.lm$coefficient[2]
intercept.low <- low.income.lm$coefficient[1]
vector_range <- seq(0, 160000, length.out = 19)
hw3_data$low_demand = slope.low*(vector_range) + intercept.low

ggplot(data = hw3_data, aes(y = price_cents, x = low_demand)) +
  geom_line() +
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for low income")

```
```{r}
high.income.lm <-lm(price_cents ~ q_high_kwh, data = hw3_data)
slope.high <- high.income.lm$coefficient[2]
intercept.high <- high.income.lm$coefficient[1]
hw3_data$high_demand = slope.high*(vector_range) + intercept.high

ggplot(data = hw3_data, aes(y = price_cents, x = high_demand)) +
  geom_line()+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Demend for high income")
```

```{r}
demand <- function(p, model){
  q <- (p - model$coefficients[1])/model$coefficients[2]
  q <- ifelse(q<0, 0, q)
  return(q)
}
```

```{r}
#demand_ex <- demand(p=2, model = high.income.lm) #(example: to find what demand function will output at price = 2)
```


```{r}
demand_agg <- function(p){
  q <- demand(p, low.income.lm) + demand(p, high.income.lm)
  q <- ifelse(q<0, 0, q)
  return(q)
}

# create new column of points for aggregate model
q_agg <- seq(0,65,3.61) # in intervals of 3.7 to have 19 points

hw3_data$demand_curve <- demand_agg(q_agg) #added a column into the hw3_data using the sequence created


ggplot(data = hw3_data, aes(y = price_cents, x = demand_curve)) +
  geom_line()+
  labs(x = "kwH",
       y = "Price of kwH",
       title = "Aggregate Demend")
```


```{r}

```

